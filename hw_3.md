#第三次作业
##3.1 BIOS
* ###BIOS从磁盘读入的第一个扇区是是什么内容？为什么没有直接读入操作系统内核映像？
{%s%}BIOS完成硬件初始化和自检后，会根据CMOS中设置的启动顺序启动相应的设备，这里假定按顺序系统要启动硬盘。但此时，文件系统并没有建立，BIOS也不知道硬盘里存放的是什么，所以BIOS是无法直接启动操作系统。另外一个硬盘可以有多个分区，每个分区都有可能包括一个不同的操作系统，BIOS也无从判断应该从哪个分区启动，所以对待硬盘，所有的BIOS都是读取硬盘的0磁头、0柱面、1扇区的内容，然后把控制权交给这里面的MBR(Main Boot Record）。
MBR由两个部分组成：即主引导记录MBR和硬盘分区表DPT。在总共512字节的主引导分区里其中MBR占446个字节（偏移0--偏移1BDH)，一般是一段引导程序，其主要是用来在系统硬件自检完后引导具有激活标志的分区上的操作系统。DPT占64个字节（偏移1BEH--偏移1FDH),一般可放4个16字节的分区信息表。最后两个字节“55，AA”（偏移1FEH，偏移1FFH)是分区的结束标志。 {%ends%}

* ###比较UEFI和BIOS的区别。
 UEFI，全称Unified Extensible Firmware Interface，即“统一的可扩展固件接口”, 是适用于电脑的标准固件接口，旨在代替BIOS（基本输入/输出系统）。此标准由UEFI联盟中的140多个技术公司共同创建，其中包括微软公司。UEFI旨在提高软件互操作性和解决BIOS的局限性。
UEFI启动对比BIOS启动的优势有三点：
安全性更强：UEFI启动需要一个独立的分区，它将系统启动文件和操作系统本身隔离，可以更好的保护系统的启动。
启动配置更灵活：EFI启动和GRUB启动类似，在启动的时候可以调用EFIShell，在此可以加载指定硬件驱动，选择启动文件。比如默认启动失败，在EFIShell加载U盘上的启动文件继续启动系统。
支持容量更大:传统的BIOS启动由于MBR的限制，默认是无法引导超过2TB以上的硬盘的。随着硬盘价格的不断走低，2TB以上的硬盘会逐渐普及，因此UEFI启动也是今后主流的启动方式。

* ###描述PXE的大致启动流程。
客户端电脑开机后，BIOS设置从网络启动
网卡中的PXE Boot ROM自测，获得控制权，然后发送一个动态获得IP地址的广播包。
DHCP服务器在收到该广播包后，发送给客户端分配IP地址的DHCP回应包。内容包括客户端的IP地址，TFTP服务器的IP地址（DHCP服务器的066选项），预设通讯通道，及开机启动文件（DHCP服务器的067选项）。该文件应该是一种由PXE启动规范规定的固定格式的可执行文件，类似于Windows XP正常启动时显示多重启动菜单之前的启动代码。
客户面收到DHCP回应后，则会响应一个FRAME，以请求传送启动文件。之后，服务端将和客户机再进行一系列应答，决定启动参数。
客户端通过TFTP通讯协议从服务器下载开机启动文件。启动文件接收完成后，将控制权转交给启动块，完成PXE启动。客户端通过这个开机影像文件开机，这个开机文件可以只是单纯的开机程式也可以是操作系统。 {%ends%}
##3.2 系统启动流程

* ###分区引导扇区的结束标志是什么？
0X55AA
* ###如何指定内核加载的参数？
加载程序的启动菜单
* ###BIOS、BIOS-MBR、BIOS-GPT的区别是什么？
只支持一个分区、支持4个启动分区、支持更多启动分区
* ###在UEFI中的可信启动有什么作用？
通过启动前的数字签名检查来保证启动介质的安全性
* ###了解NTLDR的启动流程。
访问启动盘的文件系统 (FAT 或者 NTFS)
如果 Windows 处于冬眠模式，将 hiberfil.sys 载入内存，系统恢复至冬眠前的状况
否则读取 boot.ini，显示启动菜单提示用户
如果用户选择了非 NT-based 的系统，NTLDR 加载 boot.ini 内列出的文件，交出控制权
如果选择 NT-based 的系统，NTLDR 运行 ｀ntdetect.com｀，获取电脑硬件信息
运行 Ntoskrnl.exe，把上面获得的信息提交给它 
* ###了解GRUB的启动流程。
BIOS加载MBR里面的GRUB，由于只有GRUB只占用446字节所以不能实现太多的功能，所以就有此阶段里面的文件来加载下一阶段的文件（/boot/grub下的文件）
加载识别文件系统的程序，来识别文件系统，不加载就无法识别文件系统，进而就找不到boot目录，由于GRUB是无法识别LVM，所以不能把/boot分区设置为LVM，所以必须要把/boot单独分区
开始寻找内核，启动内核 
* ###比较NTLDR和GRUB的功能有差异。
ntldr功能很少，只能引导win，只能装在硬盘；
grub是第三方操作系统引导器，从多种设备引导，也可以引导多种操作系统 
* ###了解u-boot的功能。
u-boot 是一个主要用于嵌入式系统的引导程序，可以支持多种不同的计算机系统结构，包括 PPC、ARM、AVR32、MIPS、x86、68k、Nios 与 MicroBlaz,有丰富的设备驱动源码，如串口、以太网、SDRAM、FLASH、LCD、NVRAM、EEPROM、RTC、键盘等。u-boot不仅仅支持嵌入式Linux系统的引导，它还支持NetBSD, VxWorks, QNX, RTEMS, ARTOS, LynxOS, android嵌入式操作系统。
##3.3 中断、异常和系统调用比较
* ###什么是中断、异常和系统调用？
中断：外部意外的响应；
异常：指令执行意外的响应；
系统调用：系统调用指令的响应；
* ###中断、异常和系统调用的处理流程有什么异同？
第一类是由CPU外部引起的，称作中断，如I/O中断、时钟中断、控制台中断等。第二类是来自CPU的内部事件或程序执行中的事件引起的过程，称作异常，如由于CPU本身故障（电源电压低于105V或频率在47～63Hz之外）、程序故障（非法操作码、地址越界、浮点溢出等）等引起的过程。
第三类由于在程序中使用了请求系统服务的系统调用而引发的过程，称作“陷入”(trap,或者陷阱)。前两类通常都称作中断，它们的产生往往是无意、被动的，而陷入是有意和主动的。
* ###如何理解系统调用的同步和异步响应？
同步响应：有些系统调用要等系统服务完成后才返回；异步响应：有些系统调用在系统服务没完成就返回了；{%ends%}
* ###系统调用表的内容是什么？
系统调用的功能编号和入口地址
* ###Linux的系统调用有哪些？大致的功能分类有哪些？ (w2l1)
 Linux的系统调用大概有250个左右，其继承了UNIX系统调用中最基本和最有用的部分，按照功能逻辑大致可以分为如下几类：
进程控制：创建、终止、挂起进程等基本操作以及进程信息的查询
文件系统控制：打开、关闭、读写文件等基本操作以及更改文件属性等系统操作
系统控制：系统内核相关信息的查询以及一些系统级别的控制操作
内存管理：分配、释放内存、地址映射、缓冲写回等内存相关的操作
网络管理：域名的查询和设置以及主机名称、标识号的查询与设置
socket控制：建立连接、发送消息、断开连接等一系列套接字操作
用户管理：用户和组相关信息的设置和查询
进程间通信：进程间的消息、信号、管道、共享内存等通信操作 {%ends%}
以ucore lab8的answer为例，uCore的系统调用有哪些？大致的功能分类有哪些？(w2l1)
ucore lab8的answer中共有22个系统调用，大致分为如下几类 {%s%}
进程管理：包括 fork/exit/wait/exec/yield/kill/getpid/sleep
文件操作：包括 open/close/read/write/seek/fstat/fsync/getcwd/getdirentry/dup
内存管理：pgdir命令
外设输出：putc命令 
##3.6 请分析函数调用和系统调用的区别
* ###系统调用与函数调用的区别是什么？ 
指令不同
特权级不同
堆栈切换

* ###通过分析int、iret、call和ret的指令准确功能和调用代码，比较函数调用与系统调用的堆栈操作有什么不同？
SS:SP压栈